<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="es" xml:lang="es" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>

        <title>SB Admin 2 - Register</title>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <!-- Custom fonts for this template-->
        <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css"/>
        <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
              rel="stylesheet"/>

        <!-- Custom styles for this template-->
        <link href="css/sb-admin-2.min.css" rel="stylesheet"/>
        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js" type="text/javascript"></script>
        <h:outputScript library="javax.faces" name="jsf.js" target="head" />
    </h:head>
    <body class="bg-gradient-primary">
        <f:view>
            <div class="container">

                <div class="card o-hidden border-0 shadow-lg my-5">
                    <div class="card-body p-0">
                        <!-- Nested Row within Card Body -->
                        <div class="row">
                            <div class="col-lg-6 d-none d-lg-block">
                                <img src="image/login.jpg" style="max-width: 100%; min-height: 100%;" alt="alt"/>
                            </div>
                            <div class="col-lg-6">
                                <div class="tab-content">
                                    <div class="p-5" id="formulario">
                                        <div class="text-center">
                                            <h1 class="h4 text-gray-900 mb-4">Crear cuenta!</h1>
                                        </div>
                                        <div>
                                            <a href="#" onclick="change(2);" class="btn btn-danger btn-user btn-block">
                                                Docente
                                            </a>
                                            <a href="#" onclick="change(3);" class="btn btn-primary btn-user btn-block">
                                                Alumno
                                            </a>
                                        </div>
                                    </div>
                                    <div class="p-5" id="formulario2" style="display: none;">
                                        <div class="text-center">
                                            <h1 class="h4 text-gray-900 mb-4">Crear cuenta!</h1>
                                        </div>
                                        <form class="user">
                                            <div class="form-group">
                                                <input type="text" class="form-control custom-auto-height" id="nombreUser"
                                                       placeholder="Nombre" maxlength="50"/>
                                            </div>
                                            <div class="form-group row">
                                                <div class="col-sm-6">
                                                    <input type="text" class="form-control custom-auto-height" id="apellidoPUser"
                                                           placeholder="Apellido Paterno" maxlength="50"/>
                                                </div>
                                                <div class="col-sm-6">
                                                    <input type="text" class="form-control custom-auto-height" id="apellidoMUser"
                                                           placeholder="Apellido Materno" maxlength="50"/>
                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                <div class="col-sm-6">
                                                    <input type="text" class="form-control custom-auto-height" id="rutUser"
                                                           placeholder="Rut (12345678-9)" maxlength="10"/>
                                                </div>
                                                <div class="col-sm-6">
                                                    <input type="email" class="form-control custom-auto-height" id="emailUser"
                                                           placeholder="Correo Electrónico" maxlength="100"/>

                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                <div class="col-sm-6 mb-3 mb-sm-0">
                                                    <input type="password" class="form-control custom-auto-height"
                                                           id="passUser" placeholder="Contraseña" maxlength="50"/>
                                                </div>
                                                <div class="col-sm-6">
                                                    <input type="password" class="form-control custom-auto-height"
                                                           id="passRUser" placeholder="Repita contraseña" maxlength="50"/>
                                                </div>
                                            </div>
                                            <a href="#" onclick="continuar();" class="btn btn-primary btn-user btn-block">
                                                Continuar
                                            </a>
                                        </form>
                                        <hr/>
                                        <div class="text-center">
                                            <a class="small" href="login.xhtml">¿Tienes una cuenta? Inicia sesión!</a>
                                        </div>
                                    </div>
                                    <div class="p-5" id="formulario3" style="display:none;">
                                        <div class="text-center">
                                            <div class="form-group row">
                                                <div class="col-sm">
                                                    <a class="btn btn-primary btnAtras" onclick="atras()" >Atrás</a>
                                                </div>
                                                <div class="col-sm">
                                                    <h1 class="h4 text-gray-900 mb-4">Crear cuenta!</h1>
                                                </div>
                                                <div class="col-sm"></div>
                                            </div>
                                        </div>
                                        <h:form class="user" id="hform">
                                            <div class="form-group row" id="fechaAlumno">
                                                <div class="col-sm-6 mb-3 mb-sm-0">
                                                    <h:selectOneMenu value="#{dropdownBean.cursoSeleccionado}" id="cursoUser" class="form-control custom-auto-height">
                                                        <f:selectItems value="#{dropdownBean.lstCurso}" var="curso" itemValue="#{curso.idCurso}" itemLabel="#{curso.descripcion}"/>
                                                    </h:selectOneMenu>
                                                </div>
                                                <div class="col-sm-6">
                                                    <input type="date" class="form-control custom-auto-height"
                                                           id="fechaANUser" placeholder="Fecha nacimiento"/>
                                                </div>
                                            </div>
                                            <div class="form-group" id="fechaDocente" style="display: none;">
                                                <input type="date" class="form-control custom-auto-height"
                                                       id="fechaDNUser" placeholder="Fecha nacimiento"/>
                                            </div>
                                            <div class="form-group row">
                                                <div class="col-sm-6">
                                                    <input type="text" class="form-control custom-auto-height" id="calleUser"
                                                           placeholder="Calle" maxlength="200"/>
                                                </div>
                                                <div class="col-sm-6">
                                                    <input type="number" class="form-control custom-auto-height" id="numUser"
                                                           placeholder="Numeración" min="0"/>
                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                <div class="col-sm-6">
                                                    <h:selectOneMenu value="#{dropdownBean.paisSeleccionado}" id="paisUser" class="form-control custom-auto-height">
                                                        <f:selectItems value="#{dropdownBean.lstPais}" var="pais" itemValue="#{pais.idPais}" itemLabel="#{pais.descripcion}"/>
                                                        <f:ajax render="ciudadUser" listener="#{dropdownBean.recargarCiudad}" />
                                                    </h:selectOneMenu>
                                                </div>
                                                <div class="col-sm-6">
                                                    <h:selectOneMenu value="#{dropdownBean.ciudadSeleccionada}" id="ciudadUser" class="form-control custom-auto-height">
                                                        <f:selectItems value="#{dropdownBean.ciudades}" var="ciudad" itemValue="#{ciudad.idCiudad}" itemLabel="#{ciudad.descripcion}"/>
                                                        <f:ajax render="comunaUser" listener="#{dropdownBean.recargarComuna}" />
                                                    </h:selectOneMenu>
                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                <div class="col-sm-6">
                                                    <h:selectOneMenu value="#{dropdownBean.comunaSeleccionada}" id="comunaUser" class="form-control custom-auto-height">
                                                        <f:selectItems value="#{dropdownBean.comunas}" var="comuna" itemValue="#{comuna.idComuna}" itemLabel="#{comuna.descripcion}"/>
                                                    </h:selectOneMenu>
                                                </div>
                                                <div class="col-sm-6">
                                                    <select id="sexoUser" class="form-control custom-auto-height">
                                                        <option value="0" disabled="true" selected="true">Seleccione su sexo</option>
                                                        <option value="Hombre">Hombre</option>
                                                        <option value="Mujer">Mujer</option>
                                                        <option value="Otro">Otro</option>
                                                    </select>   
                                                </div>
                                            </div>
                                            <a href="#" onclick="registrar();" class="btn btn-primary btn-user btn-block">
                                                Registrar
                                            </a>
                                        </h:form>
                                        <hr/>
                                        <div class="text-center">
                                            <a class="small" href="login.xhtml">¿Tienes una cuenta? Inicia sesión!</a>
                                        </div>
                                    </div>                               
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <h:form>
                    <div style="display:none;">
                        <p:remoteCommand name="register" value="Registrar" action="#{register.createAccount()}" ignoreAutoUpdate="true" />
                    </div>
                </h:form> 
            </div>
        </f:view>
        <script src="js/global.js" type="text/javascript"></script>
        <!-- Bootstrap core JavaScript-->
        <script src="vendor/jquery/jquery.min.js" type="text/javascript"></script>
        <script src="vendor/bootstrap/js/bootstrap.bundle.min.js" type="text/javascript"></script>
        <!-- Core plugin JavaScript-->
        <script src="vendor/jquery-easing/jquery.easing.min.js" type="text/javascript"></script>
        <!-- Custom scripts for all pages-->
        <script src="js/sb-admin-2.min.js" type="text/javascript"></script>
        <script>
                                                var api_cargar_pais = link + "index.xhtml?lstPais=";
                                                var tipoUs = 0;
                                                function change(tipoUser) {
                                                    $("#formulario").hide();
                                                    $("#formulario2").show();
                                                    tipoUs = tipoUser;
                                                }
                                                function regis() {
                                                    var fechaN = "";
                                                    var curso = 0;
                                                    //enviar datos
                                                    var filterVal = 'blur(10px)';
                                                    $(".limiter").css({
                                                        'filter': filterVal,
                                                        'transition': 'all 0.10s ease-out',
                                                        '-webkit-transition': 'all 0.10s ease-out',
                                                        '-moz-transition': 'all 0.10s ease-out',
                                                        '-o-transition': 'all 0.10s ease-out',
                                                        'pointer-events': 'none'
                                                    });
                                                    document.body.style.cursor = 'wait';
                                                    fechaN = tipoUs == 3 ? document.getElementById("fechaANUser").value : document.getElementById("fechaDNUser").value;
                                                    curso = tipoUs == 3 ? document.getElementById("hform:cursoUser").value : 0;
                                                    let made =
                                                            [{"rut": document.getElementById("rutUser").value, "nombre": document.getElementById("nombreUser").value,
                                                                    "apellidoP": document.getElementById("apellidoPUser").value, "apellidoM": document.getElementById("apellidoMUser").value,
                                                                    "tipoUser": tipoUs, "pass": document.getElementById("passUser").value, "correo": document.getElementById("emailUser").value,
                                                                    "calle": document.getElementById("calleUser").value, "numU": document.getElementById("numUser").value,
                                                                    "comuna": document.getElementById("hform:comunaUser").value, "ciudad": document.getElementById("hform:ciudadUser").value,
                                                                    "pais": document.getElementById("hform:paisUser").value, "sexo": document.getElementById("sexoUser").value,
                                                                    "fechaN": fechaN, "curso": curso}];
                                                    register([{name: 'registrarUsuario', value: JSON.stringify(made)}]);
                                                    document.body.style.cursor = 'default';
                                                }
                                                function atras() {
                                                    $("#formulario3").hide();
                                                    $("#formulario2").show();
                                                }
                                                function continuar() {
                                                    var error = 0;
                                                    var r = 0;
                                                    if ($('#nombreUser').val().length == 0) {
                                                        error = error + 1;
                                                        $('#nombreUser').attr('style', 'border-color:red');
                                                    } else {
                                                        $('#nombreUser').removeAttr('style', 'border-color:red');
                                                    }
                                                    if ($('#apellidoPUser').val().length == 0) {
                                                        error = error + 1;
                                                        $('#apellidoPUser').attr('style', 'border-color:red');
                                                    } else {
                                                        $('#apellidoPUser').removeAttr('style', 'border-color:red');
                                                    }
                                                    //PREGUNTAR
                                                    if ($('#apellidoMUser').val().length == 0) {
                                                        error = error + 1;
                                                        $('#apellidoMUser').attr('style', 'border-color:red');
                                                    } else {
                                                        $('#apellidoMUser').removeAttr('style', 'border-color:red');
                                                    }
                                                    if ($('#rutUser').val().length == 0) {
                                                        error = error + 1;
                                                        $('#rutUser').attr('style', 'border-color:red');
                                                    } else {
                                                        $('#rutUser').removeAttr('style', 'border-color:red');
                                                        if (Fn.validaRut($("#rutUser").val())) {
                                                        } else {
                                                            r = 2;
                                                            $('#rutUser').attr('style', 'border-color:red');                                                            
                                                            swal("Oops!", "El rut es invalido!", "error");
                                                        }
                                                    }
                                                    if ($('#emailUser').val().length == 0) {
                                                        error = error + 1;
                                                        $('#emailUser').attr('style', 'border-color:red');
                                                    } else {
                                                        $('#emailUser').removeAttr('style', 'border-color:red');
                                                    }
                                                    if ($('#passUser').val().length == 0) {
                                                        error = error + 1;
                                                        $('#passUser').attr('style', 'border-color:red');
                                                    } else {
                                                        $('#passUser').removeAttr('style', 'border-color:red');
                                                    }
                                                    if ($('#passRUser').val().length == 0) {
                                                        error = error + 1;
                                                        $('#passRUser').attr('style', 'border-color:red');
                                                    } else {
                                                        $('#passRUser').removeAttr('style', 'border-color:red');
                                                    }
                                                    if ($("#passUser").val() != $("#passRUser").val()) {
                                                        swal("Oops!", "Las contraseñas no coinciden!", "error");
                                                        r = 1;
                                                    }
                                                    if (r == 1) {
                                                        swal("Oops!", "Las contraseñas no coinciden!", "error");
                                                    } else {
                                                        if (error != 0) {
                                                            swal("Oops!", "Debes completar el formulario!", "error");
                                                        } else if (r != 2) {
                                                            //CONTINUAR
                                                            $("#formulario").hide();
                                                            $("#formulario2").hide();
                                                            if (tipoUs == 2) {
                                                                $("#fechaAlumno").hide();
                                                                $("#fechaDocente").show();
                                                            }
                                                            $("#formulario3").show();

                                                        }
                                                    }
                                                }
                                                function registrar() {
                                                    var error = 0;
                                                    if (tipoUs == 3) {
                                                        if ($('#cursoUser').val() == 0) {
                                                            error = error + 1;
                                                            $('#cursoUser').attr('style', 'border-color:red');
                                                        } else {
                                                            $('#cursoUser').removeAttr('style', 'border-color:red');
                                                        }
                                                        if ($('#fechaANUser').val() == "") {
                                                            error = error + 1;
                                                            $('#fechaANUser').attr('style', 'border-color:red');
                                                        } else {
                                                            $('#fechaANUser').removeAttr('style', 'border-color:red');
                                                        }
                                                    } else if (tipoUs == 2) {
                                                        if ($('#fechaDNUser').val() == "") {
                                                            error = error + 1;
                                                            $('#fechaDNUser').attr('style', 'border-color:red');
                                                        } else {
                                                            $('#fechaDNUser').removeAttr('style', 'border-color:red');
                                                        }
                                                    }
                                                    if ($('#calleUser').val().length == 0) {
                                                        error = error + 1;
                                                        $('#calleUser').attr('style', 'border-color:red');
                                                    } else {
                                                        $('#calleUser').removeAttr('style', 'border-color:red');
                                                    }
                                                    if ($('#numUser').val().length == 0) {
                                                        error = error + 1;
                                                        $('#numUser').attr('style', 'border-color:red');
                                                    } else {
                                                        $('#numUser').removeAttr('style', 'border-color:red');
                                                    }
                                                    if ($('#paisUser').val() == 0) {
                                                        error = error + 1;
                                                        $('#paisUser').attr('style', 'border-color:red');
                                                    } else {
                                                        $('#paisUser').removeAttr('style', 'border-color:red');
                                                    }
                                                    if ($('#ciudadUser').val() == 0) {
                                                        error = error + 1;
                                                        $('#ciudadUser').attr('style', 'border-color:red');
                                                    } else {
                                                        $('#ciudadUser').removeAttr('style', 'border-color:red');
                                                    }
                                                    if ($('#comunaUser').val() == 0) {
                                                        error = error + 1;
                                                        $('#comunaUser').attr('style', 'border-color:red');
                                                    } else {
                                                        $('#comunaUser').removeAttr('style', 'border-color:red');
                                                    }
                                                    if (error != 0) {
                                                        swal("Oops!", "Debes completar el formulario!", "error");
                                                    } else {
                                                        console.log(document.getElementById("sexoUser"));
                                                        regis();
                                                    }
                                                }
                                                // Valida el rut con su cadena completa "XXXXXXXX-X"
                                                var Fn = {
                                                    validaRut: function (rutCompleto) {
                                                        rutCompleto = rutCompleto.replace("‐", "-");
                                                        if (!/^[0-9]+[-|‐]{1}[0-9kK]{1}$/.test(rutCompleto))
                                                            return false;
                                                        var tmp = rutCompleto.split('-');
                                                        var digv = tmp[1];
                                                        var rut = tmp[0];
                                                        if (digv == 'K')
                                                            digv = 'k';

                                                        return (Fn.dv(rut) == digv);
                                                    },
                                                    dv: function (T) {
                                                        var M = 0, S = 1;
                                                        for (; T; T = Math.floor(T / 10))
                                                            S = (S + T % 10 * (9 - M++ % 6)) % 11;
                                                        return S ? S - 1 : 'k';
                                                    }
                                                }
        </script>
    </body>
</html>
